<!doctype html>
<html>
<head>
    <title>doc api aws</title>
    <meta charset="utf-8">
    <style>
        body {
            background-color: #222021;
            color: #BEBDB8;
            font-family: sans-serif;
        }

        #placement {
            margin: auto;
            width: 50%;
            /*border: 3px solid green;*/
            padding: 10px;
        }

        .centre {
            margin: auto;
            width: 50%;
            padding: 10px;
            border-bottom: 1px solid grey;
            border-top: 1px solid grey;
        }

        .method {
            text-align: end;
            display: inline-block;
            float: right;
        }

        .url {
            float: left;
        }

        .GET {
            background-color: #1d3564;
            font-weight: 700;
            /*border: 3px solid grey;*/
        }

        .POST {
            background-color: #29681e;
            font-weight: 700;
            /*border: 3px solid grey;*/
        }

        .PUT {
            background-color: #985d10;
            font-weight: 700;
            /*border: 3px solid grey;*/
        }

        .DELETE {
            background-color: #910f0f;
            font-weight: 700;
            /*border: 3px solid grey;*/
        }
    </style>
</head>
<body>
    <div id="placement">
        <h2>Obtention d'un token:</h2>
        <p class="undertitle">Les requêtes nécessitent pour la plupart un token JWT. <br />Ces tokens doivent être placés dans le header "Authorization": "Bearer <i>TOKEN</i>"</p>
        <p class="undertitle">
            Pour obtenir un token administrateur, faire une requête à /admins/login (voir documentation),
            <br />
            avec comme corps de requête: { "admin": { "adminname": "<i>identifiant</i>", "password": "<i>motDePasse</i>" } }
            <br />
            Identifiants pour obtenir token administrateur: Adminname "admin1", Mot de passe "admin1"
        </p>
        <p class="undertitle">
            Pour obtenir un token utilisateur, faire une requête à /users/login (voir documentation),
            <br />
            avec comme corps de requête: { "user": { "username": "<i>identifiant</i>", "password": "<i>motDePasse</i>" } }
            <br />
            Identifiants pour obtenir token utilisateur: Username "jimHalpert", Mot de passe "cecedad"
        </p>
        <h2>Admins</h2>
        <p class="undertitle">https://epreuve.idea43.net/api/admins</p>
        <p class="undertitle">Paramètres d'URL: {admin} doit être remplacé par l'id d'un administrateur.</p>

        <div class="centre GET">
            <span class="url">/{admin}</span> <span class="method">GET</span>
            <br>
            <hr>
            <p>
                Query: <i>none</i>.
            </p>
            <p>
                Token nécessaire: Administrateur.
            </p>
            <p>
                Renvoie les infos de l'administrateur dont l'id correspond à <i>{admin}</i>.
            </p>
        </div>
        <div class="centre POST">
            <span class="url">/login</span> <span class="method">POST</span>
            <br>
            <hr>
            <p>
                Query: <i>none</i>.
            </p>
            <p>
                Token nécessaire: <i>none</i>.
            </p>
            <p>
                Permets de login un administrateur en passant dans le corps de la requête le <i>adminname</i> et le <i>password</i>.
                <br>
                Renvoie l'administrateur connecté, avec un token.
            </p>
        </div>
        <div class="centre POST">
            <span class="url">/logout</span> <span class="method">POST</span>
            <br>
            <hr>
            <p>
                Query: <i>none</i>.
            </p>
            <p>
                Token nécessaire: <i>none</i>.
            </p>
            <p>
                Permets de logout un administrateur.
                <br>
                Ne fait rien côté serveur, mais côté client il faut supprimer le token.
                <br>
                Renvoie un message de confirmation du logout.
            </p>
        </div>
        <div class="centre POST">
            <span class="url">/</span> <span class="method">POST</span>
            <br>
            <hr>
            <p>
                Query: <i>none</i>.
            </p>
            <p>
                Token nécessaire: Administrateur.
            </p>
            <p>
                Permet de créer un nouvel administrateur.
                <br>
                Les champs <i>adminname</i> et <i>password</i> doivent être renseignés (obligatoire) dans le corps de la requête.
                <br>
                On peut aussi préciser: <i>email, nom, prenom</i>.
                <br />
                <br />
                Exemple de corps de requête: { "admin": { "adminname": "newName", "password": "newPass", "email": "new@email.com" }}
                <br />
                <br>
                Renvoie l'administrateur créé.
            </p>
        </div>
        <div class="centre PUT">
            <span class="url">/{admin}</span> <span class="method">PUT</span>
            <br>
            <hr>
            <p>
                Query: <i>none</i>.
            </p>
            <p>
                Token nécessaire: Administrateur.
            </p>
            <p>
                Mets à jour les champs de l'administrateur dont l'id correspond à <i>{admin}</i>.
                <br>
                Champs à changer: <i>adminname</i>, <i>email</i>, <i>password</i>, <i>nom</i>, <i>prenom</i>.
                <br>
                <br />
                Exemple de corps de requête: { "admin": { "email": "newEmailValue" } }
                <br />
                <br />
                Renvoie l'administrateur modifié.
            </p>
        </div>
        <div class="centre DELETE">
            <span class="url">/{admin}</span> <span class="method">DELETE</span>
            <br>
            <hr>
            <p>
                Query: <i>none</i>.
            </p>
            <p>
                Token nécessaire: Administrateur.
            </p>
            <p>
                Supprime l'administrateur dont l'id correspond à <i>{admin}</i>.
                <br>
                Renvoie un message de confirmation de suppression de l'administrateur.
            </p>
        </div>

        <h2>Users</h2>
        <p class="undertitle">https://epreuve.idea43.net/api/users</p>
        <p class="undertitle">Paramètres d'URL: {user} doit être remplacé par l'id d'un utilisateur.</p>

        <div class="centre GET">
            <span class="url">/</span> <span class="method">GET</span>
            <br>
            <hr>
            <p>
                Query: <i>none</i>.
            </p>
            <p>
                Token nécessaire: Administrateur.
            </p>
            <p>
                Renvoie la liste des utilisateurs.
            </p>
        </div>
        <div class="centre GET">
            <span class="url">/{user}</span> <span class="method">GET</span>
            <br>
            <hr>
            <p>
                Query: <i>none</i>.
            </p>
            <p>
                Token nécessaire: Administrateur.
            </p>
            <p>
                Renvoie les informations de l'utilisateur dont l'id correspond à <i>{user}</i>.
                <br />
                Cette requête est aussi possible avec un token utilisateur, sous la condition que le token appartienne à l'utilisateur dont on demande les informations.
            </p>
        </div>
        <div class="centre GET">
            <span class="url">/{user}/projets</span> <span class="method">GET</span>
            <br>
            <hr>
            <p>
                Query: <i>none</i>.
            </p>
            <p>
                Token nécessaire: Utilisateur.
                <br />
                <br />
                Le Token doit être celui de l'utilisateur dont l'ID correspond à {user}.
            </p>
            <p>
                Renvoie la liste des projets appartenant à l'utilisateur dont l'ID correspond à <i>{user}</i>.
            </p>
        </div>
        <div class="centre POST">
            <span class="url">/login</span> <span class="method">POST</span>
            <br>
            <hr>
            <p>
                Query: <i>none</i>.
            </p>
            <p>
                Token nécessaire: <i>none</i>.
            </p>
            <p>
                Permets de login un user en passant dans le corps de la requête le <i>username</i> et le <i>password</i>.
                <br>
                Renvoie l'user connecté, avec un token.
            </p>
        </div>
        <div class="centre POST">
            <span class="url">/logout</span> <span class="method">POST</span>
            <br>
            <hr>
            <p>
                Query: <i>none</i>.
            </p>
            <p>
                Token nécessaire: <i>none</i>.
            </p>
            <p>
                Permets de logout un user.
                <br>
                Ne fait rien côté serveur, mais côté client il faut supprimer le token.
                <br>
                Renvoie un message de confirmation du logout.
            </p>
        </div>
        <div class="centre POST">
            <span class="url">/</span> <span class="method">POST</span>
            <br>
            <hr>
            <p>
                Query: <i>none</i>.
            </p>
            <p>
                Token nécessaire: Administrateur.
            </p>
            <p>
                Permet de créer un nouveau user.
                <br>
                Les champs <i>username</i>, <i>password</i> et <i>entreprise</i> doivent être renseignés (obligatoires) dans le corps de la requête.
                <br />
                Le champ <i>entreprise</i> doit correspondre à un ID d'une entreprise existante!
                <br />
                <br />
                Peuvent aussi être indiqués les champs: <i>email, telephone, nom, prenom</i>.
                <br>
                <br />
                Exemple de corps de requête: { "user": { "username": "newName", "password": "newPass", "entreprise": "idEntreprise", "email": "new@email.com" }}
                <br />
                <br />
                Renvoie l'user créé.
            </p>
        </div>
        <div class="centre PUT">
            <span class="url">/{user}</span> <span class="method">PUT</span>
            <br>
            <hr>
            <p>
                Query: <i>none</i>.
            </p>
            <p>
                Token nécessaire: Administrateur.
            </p>
            <p>
                Mets à jour les données de l'user dont l'id correspond à <i>{user}</i>.
                <br>
                Champs à changer: <i>username</i>, <i>email</i>, <i>telephone</i>, <i>password</i>, <i>nom</i>, <i>prenom</i>.
                <br />
                <br>
                Exemple de corps de requête: { "user": { "telephone": "0123456789" }}
                <br />
                <br />
                Renvoie les nouvelles données de l'user.
            </p>
        </div>
        <div class="centre DELETE">
            <span class="url">/{user}</span> <span class="method">DELETE</span>
            <br>
            <hr>
            <p>
                Query: <i>none</i>.
            </p>
            <p>
                Token nécessaire: Administrateur.
            </p>
            <p>
                Supprime l'user dont l'id correspond à <i>{user}</i>.
                <br>
                Renvoie un message de confirmation de suppression de l'user.
            </p>
        </div>


        <h2>Entreprises</h2>
        <p class="undertitle">https://epreuve.idea43.net/api/entreprises</p>
        <p class="undertitle">Paramètres d'URL: {entreprise} doit être remplacé par l'id d'une entreprise.</p>

        <div class="centre GET">
            <span class="url">/{entreprise}</span> <span class="method">GET</span>
            <br>
            <hr>
            <p>
                Query: <i>none</i>.
            </p>
            <p>
                Token nécessaire: Administrateur.
            </p>
            <p>
                Renvoie les informations de l'entreprise dont l'id correspond à <i>{entreprise}</i>.
            </p>
        </div>
        <div class="centre GET">
            <span class="url">/</span> <span class="method">GET</span>
            <br>
            <hr>
            <p>
                Query: <i>none</i>.
            </p>
            <p>
                Token nécessaire: Administrateur.
            </p>
            <p>
                Renvoie une liste des entreprises.
            </p>
        </div>
        <div class="centre POST">
            <span class="url">/</span> <span class="method">POST</span>
            <br>
            <hr>
            <p>
                Query: <i>none</i>.
            </p>
            <p>
                Token nécessaire: Administrateur.
            </p>
            <p>
                Permets de créer une nouvelle entreprise.
                <br>
                Le champ <i>nom</i> de l'entreprise doit être renseigné.
                <br>
                On peut renseigner les champs: <i>email</i>, <i>telephone</i>, <i>adresse</i>.
                <br>
                Renvoie les informations de l'entreprise créée.
            </p>
        </div>
        <div class="centre PUT">
            <span class="url">/{entreprise}</span> <span class="method">PUT</span>
            <br>
            <hr>
            <p>
                Query: <i>none</i>.
            </p>
            <p>
                Token nécessaire: Administrateur.
            </p>
            <p>
                Mets à jour les données de l'entreprise dont l'id correspond à <i>{entreprise}</i>.
                <br>
                Champs à changer: <i>nom</i>, <i>email</i>, <i>telephone</i>, <i>adresse</i>.
                <br>
                Renvoie les données de l'entreprise modifiée.
            </p>
        </div>
        <div class="centre DELETE">
            <span class="url">/{entreprise}</span> <span class="method">DELETE</span>
            <br>
            <hr>
            <p>
                Query: <i>none</i>.
            </p>
            <p>
                Token nécessaire: Administrateur.
            </p>
            <p>
                Supprime l'entreprise dont l'id correspond à <i>{entreprise}</i>.
                <br>
                Renvoie un message de confirmation de la suppression de l'entreprise.
            </p>
        </div>

        <h2>Projets</h2>
        <p class="undertitle">https://epreuve.idea43.net/api/projets</p>

        <div class="centre GET">
            <span class="url">/</span> <span class="method">GET</span>
            <br>
            <hr>
            <p>
                Query: <i>none</i>.
            </p>
            <p>
                Token nécessaire: User.
            </p>
            <p>
                Renvoie une liste de projets appartenant au user auquel appartient le token. La taille de la liste est indiquée par la query <i>limit</i>, la page est indiquée par la query <i>page</i>.
            </p>
        </div>
        <div class="centre GET">
            <span class="url">/{fileName}</span> <span class="method">GET</span>
            <br>
            <hr>
            <p>
                Query: <i>none</i>.
            </p>
            <p>
                Token nécessaire: User.
            </p>
            <p>
                Renvoie les informations sur le projet concerné avec une url pour télécharger le fichier du projet. Le user auquel appartient le token doit être propriétaire de ce projet.
                <br>
                L'url de téléchargement est valide pour 1 minute.
                <br>
                <i>{fileName}</i> doit correspondre au nom du projet.
            </p>
        </div>
        <div class="centre POST">
            <span class="url">/{fileName}</span> <span class="method">POST</span>
            <br>
            <hr>
            <p>
                Query: <i>none</i>.
            </p>
            <p>
                Token nécessaire: User.
            </p>
            <p>
                Créé un projet avec les informations contenues dans le corps de la requête.
                <br>
                <i>{fileName}</i> correspond au nom du projet.
                <br>
                Si le projet n'existe pas, il est créé. Si il existe, il est mis à jour avec les informations données.
                <br>
                Renvoie les données du projet créé ou mis à jour, avec une URL valide pour 1 minute pour upload le fichier sur AWS S3.
            </p>
        </div>
        <div class="centre DELETE">
            <span class="url">/{fileName}</span> <span class="method">DELETE</span>
            <br>
            <hr>
            <p>
                Query: <i>none</i>.
            </p>
            <p>
                Token nécessaire: User.
            </p>
            <p>
                Supprime le projet dont le nom correspond à <i>{fileName}</i>.
                <br>
                Le user auquel appartient le token doit être le propriétaire du projet.
                <br>
                Renvoie un message de confirmation de suppression de l'objet.
            </p>
        </div>

        <h2>Base de données</h2>
        <p class="undertitle">
            La base de données utilisée est DynamoDB.<br />
            C'est une base de donnée NON-RELATIONNELLE, donc il ne convient pas de faire un MCD pour la décrire.<br />
            Cependant, uniquement pour information, voici le MCD de la base de données si elle était relationnelle:<br />
            <br />
            <img src="mcd2.png" />
            <br />
            <i>Remarque: "Test", "UserTest" et "AdminTest" sont en fait deux tables: Utilisateur et Administrateur, comme présenté sous ce 2ème MCD:</i>
            <br />
            <br />
            <img src="mcd1.png" />
            <br />
            <i>Ce deuxième MCD est plus fidèle à la réalité de la BDD, étant donnée qu'elle n'est pas relationnelle.</i>
            <br />
            <br />
            Les tables de la BDD sont:
            <br />
            <img src="tables.png" width="100%" />
        </p>

        <h2>Accès à la base de données</h2>
        <p class="undertitle">
            Pour accèder à la base de donnée et voir les informations qui y sont;<br />
            Se rendre sur: <a href="https://eu-west-3.console.aws.amazon.com/dynamodbv2/home?region=eu-west-3#tables">CE LIEN</a>.<br />
            Il faut se connecter en tant qu'utilisateur IAM.<br />
            Indiquer:<br />
            - ID de compte: 323327337626<br />
            - Nom d'utilisateur: idea_rest_api_s3_user<br />
            - Mot de passe: fQ5@+{yI<br />
            <br />
            Vous aurez ensuite accès aux tables.<br />
            Pour consulter les données d'une table, cliquer sur le nom de la table.<br />
            Ensuite, cliquez sur le bouton orange en haut à droite de la page indiquant "Explorer les éléments de la table".<br />
            <br />
            <img src="tables_content.png" width="100%" />

        </p>
    </div>

</body>
</html>
